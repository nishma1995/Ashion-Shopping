<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Ashion Template">
    <meta name="keywords" content="Ashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ashion</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cookie&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="/css/landing/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/css/landing/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="/css/landing/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="/css/landing/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="/css/landing/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="/css/landing/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="/css/landing/style2.css" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">


</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
        <div class="offcanvas__close">+</div>
        <ul class="offcanvas__widget">
           <li><span class="icon_search search-switch"></span></li>
                            <li class="dropdown">
                                <a class="dropdown-toggle" role="button" id="userDropdown" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                    <i class="fa fa-user"></i>
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="userDropdown">
                                    {{#if User}}
                                    <li><a class="dropdown-item" href="/myprofile">My Profile</a></li>
                                    <li><a class="dropdown-item" href="/wishlist">Wishlist</a></li>
                                    <li><a class="dropdown-item" href="/myorder">Orders</a></li>
                                    <li><a class="dropdown-item" href="/wallet">Wallet</a></li>
                                    <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                    {{else if googleUser}}
                                    <li><a class="dropdown-item" href="/myprofile">My Profile</a></li>
                                    <li><a class="dropdown-item" href="/wishlist">Wishlist</a></li>
                                    <li><a class="dropdown-item" href="/myorder">Orders</a></li>
                                    <li><a class="dropdown-item" href="/wallet">Wallet</a></li>
                                    <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                    {{else}}
                                    <!-- Show Nothing -->
                                    {{/if}}
                                </ul>
                            </li>
                            <li><a href="/cart"><i class="fa fa-shopping-cart"></i></a></li>
                        </ul>
        <div class="offcanvas__logo">
            <a href="./index.html"><img src="img/logo.png" alt=""></a>
        </div>
        <div id="mobile-menu-wrap"></div>
        <div class="offcanvas__auth">
            <a href="#">Login</a>
            <a href="#">Register</a>
        </div>
    </div>
    <!-- Offcanvas Menu End -->

    <!-- Header Section Begin -->
    <header class="header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-xl-3 col-lg-2">
                    <div class="header__logo">
                        <a href="./index.html"><img src="/img/logo.png" alt=""></a>
                    </div>
                </div>
                <div class="col-xl-6 col-lg-7">
                    <nav class="header__menu">
                        <ul>
                            <li class="active"><a href="/">Home</a></li>
                            <li><a href="/category?category=Women">Women</a></li>
                            <li><a href="/category?category=Men">Men</a></li>
                            <li><a href="/category?category=Kids">kids</a></li>
                            <li><a href="/category?category=Accessories">Accessories</a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div class="col-lg-3">
                    <div class="header__right">

                        <ul class="header__right__widget">
                            <li><span class="icon_search search-switch"></span></li>
                            <li class="dropdown">
                                <a class="dropdown-toggle" role="button" id="userDropdown" data-bs-toggle="dropdown"
                                    aria-expanded="false">
                                    <i class="fa fa-user"></i>
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="userDropdown">
                                    {{#if User}}
                                    <li><a class="dropdown-item" href="/myprofile">My Profile</a></li>
                                    <li><a class="dropdown-item" href="/wishlist">Wishlist</a></li>
                                    <li><a class="dropdown-item" href="/myorder">Orders</a></li>
                                    <li><a class="dropdown-item" href="/wallet">Wallet</a></li>
                                    <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                    {{else if googleUser}}
                                    <li><a class="dropdown-item" href="/myprofile">My Profile</a></li>
                                    <li><a class="dropdown-item" href="/wishlist">Wishlist</a></li>
                                    <li><a class="dropdown-item" href="/myorder">Orders</a></li>
                                    <li><a class="dropdown-item" href="/wallet">Wallet</a></li>
                                    <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                    {{else}}
                                    <!-- Show Nothing -->
                                    {{/if}}
                                </ul>
                            </li>
                            <li><a href="/cart"><i class="fa fa-shopping-cart"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="canvas__open">
                <i class="fa fa-bars"></i>
            </div>
        </div>
    </header>
    <!-- Header Section End -->

    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="/"><i class="fa fa-home"></i> Home</a>
                        <span>Shopping cart</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Shop Cart Section Begin -->
    <section class="shop-cart spad">
        <div class="container">

            <div class="row">

                <div class="col-lg-12">
                    <div class="shop__cart__table">
                        <div id="cartMessage" style="color:green"></div>

                        <table>

                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Stock</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {{#each details}}
                                <tr data-product-id="{{this.productId._id}}">

                                    <td class="cart__product__item">
                                        <img src="{{this.productId.image.paths.[0]}}" alt="" width="50" height="50">
                                        <div class="cart__product__item__title">
                                            <h6>{{this.productId.name}}</h6>
                                            <div class="rating">
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                                <i class="fa fa-star"></i>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="cart__stock">{{this.stock}}</td>
                                    <td class="cart__price">â‚¹{{this.finalPrice}}</td>
                                    <td class="cart__quantity">
                                        <div class="pro-qty">
                                            <input type="text" class="quantity-input" value="{{this.quantity}}">
                                        </div>
                                    </td>
                                    <td class="cart__total">â‚¹ {{this.totalprice}}</td>

                                    <td class="cart__close"><span class="icon_close"></span></td>

                                </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-6 col-sm-6">
                    <div class="cart__btn">
                        <a href="/">Continue Shopping</a>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-6">
                    {{!--<div class="cart__btn update__btn">
                        <a href="#" id="updateCartBtn"><span class="icon_loading"></span> Update cart</a>
                    </div>--}}
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    {{!-- <div class="discount__content">
                        <h6>Discount codes</h6>
                        <form action="#">
                            <input type="text" placeholder="Enter your coupon code">
                            <button type="submit" class="site-btn">Apply</button>
                        </form>
                    </div>--}}
                </div>
                <div class="col-lg-4 offset-lg-2">
                    <div class="cart__total__procced">
                        <h6>Cart total</h6>
                        <ul>
                            <li>Subtotal <span class="cart-subtotal-value">â‚¹ 750.0</span></li>
                            <li>Total <span class="cart-total-value">â‚¹ 750.0</span></li>
                        </ul>
                        <a href="/checkout" id="proceedToCheckoutBtn" class="primary-btn">Proceed to checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Shop Cart Section End -->

    <!-- Instagram Begin -->
    <div class="instagram">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                    <div class="instagram__item set-bg" data-setbg="img/instagram/insta-1.jpg">
                        <div class="instagram__text">
                            <i class="fa fa-instagram"></i>
                            <a href="#">@ ashion_shop</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                    <div class="instagram__item set-bg" data-setbg="img/instagram/insta-2.jpg">
                        <div class="instagram__text">
                            <i class="fa fa-instagram"></i>
                            <a href="#">@ ashion_shop</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                    <div class="instagram__item set-bg" data-setbg="img/instagram/insta-3.jpg">
                        <div class="instagram__text">
                            <i class="fa fa-instagram"></i>
                            <a href="#">@ ashion_shop</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                    <div class="instagram__item set-bg" data-setbg="img/instagram/insta-4.jpg">
                        <div class="instagram__text">
                            <i class="fa fa-instagram"></i>
                            <a href="#">@ ashion_shop</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                    <div class="instagram__item set-bg" data-setbg="img/instagram/insta-5.jpg">
                        <div class="instagram__text">
                            <i class="fa fa-instagram"></i>
                            <a href="#">@ ashion_shop</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                    <div class="instagram__item set-bg" data-setbg="img/instagram/insta-6.jpg">
                        <div class="instagram__text">
                            <i class="fa fa-instagram"></i>
                            <a href="#">@ ashion_shop</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Instagram End -->

    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-6 col-sm-7">
                    <div class="footer__about">
                        <div class="footer__logo">
                            <a href="./index.html"><img src="img/logo.png" alt=""></a>
                        </div>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
                            cilisis.</p>
                        <div class="footer__payment">
                            <a href="#"><img src="img/payment/payment-1.png" alt=""></a>
                            <a href="#"><img src="img/payment/payment-2.png" alt=""></a>
                            <a href="#"><img src="img/payment/payment-3.png" alt=""></a>
                            <a href="#"><img src="img/payment/payment-4.png" alt=""></a>
                            <a href="#"><img src="img/payment/payment-5.png" alt=""></a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-5">
                    <div class="footer__widget">
                        <h6>Quick links</h6>
                        <ul>
                            <li><a href="#">About</a></li>
                            <li><a href="#">Blogs</a></li>
                            <li><a href="#">Contact</a></li>
                            <li><a href="#">FAQ</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4">
                    <div class="footer__widget">
                        <h6>Account</h6>
                        <ul>
                            <li><a href="#">My Account</a></li>
                            <li><a href="#">Orders Tracking</a></li>
                            <li><a href="#">Checkout</a></li>
                            <li><a href="#">Wishlist</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4 col-md-8 col-sm-8">
                    <div class="footer__newslatter">
                        <h6>NEWSLETTER</h6>
                        <form action="#">
                            <input type="text" placeholder="Email">
                            <button type="submit" class="site-btn">Subscribe</button>
                        </form>
                        <div class="footer__social">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-youtube-play"></i></a>
                            <a href="#"><i class="fa fa-instagram"></i></a>
                            <a href="#"><i class="fa fa-pinterest"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    <div class="footer__copyright__text">
                        <p>Copyright &copy;
                            <script>document.write(new Date().getFullYear());</script> All rights reserved | This
                            template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a
                                href="https://colorlib.com" target="_blank">Colorlib</a>
                        </p>
                    </div>
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Search Begin -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch">+</div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
                
             <button type="button" id="clear-search" class="btn btn-primary">Clear</button>
            </form>
        </div>
    </div>
    <!-- Search End -->

    <!-- Js Plugins -->
    <script src="/js/landing/jquery-3.3.1.min.js"></script>
    <script src="/js/landing/bootstrap.min.js"></script>
    <script src="/js/landing/jquery.magnific-popup.min.js"></script>
    <script src="/js/landing/jquery-ui.min.js"></script>
    <script src="/js/landing/mixitup.min.js"></script>
    <script src="/js/landing/jquery.countdown.min.js"></script>
    <script src="/js/landing/jquery.slicknav.js"></script>
    <script src="/js/landing/owl.carousel.min.js"></script>
    <script src="/js/landing/jquery.nicescroll.min.js"></script>
    <script src="/js/landing/main.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

    <script>
        $(document).ready(function () {

             $('#clear-search').click(function () {
            $('#search-input').val(''); // Clear the input field
        });
            var inputField = $(this).closest('.cart__quantity').find('.quantity-input');
            updateTotalPrice(inputField);
            $(document).on('click', '.qtybtn.inc', function (event) {
                event.preventDefault();
                var inputField = $(this).closest('.cart__quantity').find('.quantity-input');
                var quantity = parseInt(inputField.val());
                inputField.val(quantity);






                updateTotalPrice(inputField);
            });


            $(document).on('click', '.qtybtn.dec', function (event) {
                event.preventDefault();
                var inputField = $(this).closest('.cart__quantity').find('.quantity-input');
                var quantity = parseInt(inputField.val());

                var row = $(this).closest('tr');
                var productId = row.data('product-id');
                if (quantity >= 1) {
                    inputField.val(quantity); // Decrement the quantity by 1

                    updateTotalPrice(inputField); // Update the total price

                } else if (quantity < 1) {
                    var row = $(this).closest('tr');
                    var productId = row.data('product-id');
                    $.ajax({
                        type: 'DELETE',
                        url: '/remove',
                        data: { productId: productId },
                        success: function (response) {
                            if (response && response.message) {
                                $('#cartMessage').text(response.message);
                                row.remove();
                                updateTotalPrice(inputField);
                            } else {
                                console.error('Error removing product from cart:', response.error);
                            }
                        },
                        error: function (xhr, status, error) {
                            console.error('AJAX error:', error);
                        }
                    });
                }
            });

            $(document).on('click', '.cart__close', function (event) {
                event.preventDefault();
                var inputField = $(this).closest('.cart__quantity').find('.quantity-input');

                var row = $(this).closest('tr');
                var productId = row.data('product-id');
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'You won\'t be able to revert this!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // If user confirms, send delete request to server


                        $.ajax({
                            type: 'DELETE',
                            url: '/remove',
                            data: { productId: productId },
                            success: function (response) {
                                if (response && response.message) {

                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Success!',
                                        text: 'item removed successfully!',
                                        toast: true,
                                        position: 'top',
                                        showConfirmButton: false,
                                        timer: 4000
                                    });
                                    row.remove();
                                    updateTotalPrice(inputField);
                                } else {

                                    console.error('Error removing product from cart:', response.error);
                                }
                            },
                            error: function (xhr, status, error) {

                                console.error('AJAX error:', error);
                            }
                        })
                    }
                })
            });




            function updateTotalPrice(inputField) {
                var quantity = parseInt(inputField.val());
                var pricePerItem = parseFloat(inputField.closest('tr').find(".cart__price").text().replace('â‚¹', '').trim());
                var totalPrice = quantity * pricePerItem;



                inputField.closest('tr').find(".cart__total").text('â‚¹' + totalPrice.toFixed(2));


                var subtotal = 0;
                $('.cart__total').each(function () {
                    var price = parseFloat($(this).text().replace('â‚¹', '').trim());
                    subtotal += price;
                });
                $('.cart-subtotal-value').text('â‚¹' + subtotal.toFixed(2));
                $('.cart-total-value').text('â‚¹' + subtotal.toFixed(2));
            }


            // Click event for the "Proceed to checkout" anchor tag
            $('#proceedToCheckoutBtn').on('click', function (event) {
                event.preventDefault(); // Prevent default anchor behavior
                var cartItems = [];
                var canProceed = true;
                if ($('.shop__cart__table tbody tr').length === 0) {
                    Swal.fire({
                        text: "Your cart is empty. Please add items to proceed.",
                        toast: true,
                        position: 'top',
                        showConfirmButton: false,
                        timer: 3000
                    });
                    return; // Exit the function to prevent further execution
                }
                $('.shop__cart__table tbody tr').each(function () {
                    var productId = $(this).data('product-id');
                    var quantity = $(this).find('.quantity-input').val();
                    var total = $(this).find('.cart__total').text().replace('â‚¹', '').trim();
                    var availableStock = parseInt($(this).find('.cart__stock').text());
                    var maxQuantityPerPerson = 6;
                    // Check if quantity exceeds available stock
                    if (quantity > availableStock || quantity > maxQuantityPerPerson) {
                        canProceed = false; // Set flag to false if any item has quantity > stock
                        var msg = (quantity > maxQuantityPerPerson) ? "Quantity exceeds available stock." : "Maximum quantity per person is 6.";
                        Swal.fire({
                            text: msg + " Please adjust quantities.",
                            toast: true,
                            position: 'top',
                            showConfirmButton: false,
                            timer: 3000
                        });
                        return false; // Exit the loop early
                    }
                    cartItems.push({ productId: productId, quantity: quantity, total: total });
                });
                if (canProceed) {
                    // Send AJAX request to update the cart
                    $.ajax({
                        type: 'PUT',
                        url: '/updateCart/${productId}',
                        contentType: 'application/json',
                        data: JSON.stringify({ cartItems: cartItems }),
                        success: function (response) {

                            // Cart updated successfully, redirect to checkout page
                            Swal.fire({
                                icon: 'success',
                                title: 'Success!',
                                text: response.message,
                                toast: true,
                                position: 'top',
                                showConfirmButton: false,
                                timer: 4000
                            });
                            setTimeout(function () {
                                window.location.href = '/checkout';
                            }, 4000)



                        },
                        error: function (xhr, status, error) {
                            console.error('AJAX error:', error);
                            // Handle AJAX error
                        }
                    });
                }
            });

            $('.search-model-form').on('submit', function (event) {
                event.preventDefault(); // Prevent the default form submission

                // Get the entered search text
                const searchText = $('#search-input').val();

                // Construct the URL with the search query as a parameter
                const searchUrl = `/search?search=${encodeURIComponent(searchText)}`;

                // Redirect to the search URL
                window.location.href = searchUrl;
            });


        });



    </script>

</body>

</html>